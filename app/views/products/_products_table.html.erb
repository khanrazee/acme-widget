<% if @products.any? %>
  <div class="product-list">
    <table class="products-table">
      <thead>
        <tr>
          <th><%= sort_link(@q, :code, "Code") %></th>
          <th><%= sort_link(@q, :name, "Name") %></th>
          <th><%= sort_link(@q, :price, "Price") %></th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @products.each do |product| %>
          <tr>
            <td><%= product.code %></td>
            <td>
              <%= product.name %>
              <% if product.special_offer %>
                <span class="badge bg-success ms-1">Special Offer</span>
              <% end %>
            </td>
            <td>
              <%= number_to_currency(product.price_in_currency) %>
              <% if product.special_offer %>
                <div class="small text-success">Buy one, get second half price!</div>
              <% end %>
            </td>
            <td class="actions">
              <%= link_to "View", product_path(product), class: "btn btn-info" %>
              <% if is_admin? %>
                <%= link_to "Edit", edit_product_path(product), class: "btn btn-warning" %>
                <%= button_to "Delete", product_path(product),
                              method: :delete,
                              form: { data: { turbo_confirm: "Are you sure you want to delete this product?" } },
                              class: "btn btn-danger" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
    
    <div class="pagination-container">
      <%= paginate @products %>
    </div>
  </div>
<% else %>
  <div class="empty-state">
    <% if params[:q].present? %>
      <p>Try adjusting your search filters or <%= link_to "view all products", products_path %>.</p>
    <% else %>
      <% if is_admin? %>
        <p>Click "Create New Product" to add your first product.</p>
      <% else %>
        <% admin = User.where(role: 'admin').first %>
        <p>No products are currently available. Please contact the administrator at <a href="mailto:<%=admin&.email %>"><%=admin&.email %></a> to request new products.</p>
      <% end %>
    <% end %>
  </div>
<% end %>
